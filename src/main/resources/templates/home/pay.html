<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="homelink/head.html :: head">
</head>
<body>

<div th:replace="homelink/body.html:: body"></div>

<div class="contact-page section">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-2">
                <div><h5 class="text-center" style="color:black">Chọn phương thức thanh toán</h5></div>
                <div class="text-center" style="margin-top: 40px">
                    <ul class="nav" style="list-style-type: none; padding: 0; margin: 0;">
                        <li class="nav-item pt-1" style="margin-bottom: 10px;">
                            <a class="nav-link" href="/home/pay">
                                <i class="menu-icon"></i>
                                <span style="font-weight: 600;">Ngân hàng MB BANK</span>
                            </a>
                        </li>
                        <li class="nav-item pt-2" style="margin-bottom: 10px;">
                            <a class="nav-link" href="/home/pay/momo">
                                <i class="menu-icon"></i>
                                <span style="font-weight: 600;">QR Code MoMo</span>
                            </a>
                        </li>
                        <li class="nav-item pt-2" style="margin-bottom: 10px;">
                            <a class="nav-link" href="/home/pay/vietelmoney">
                                <i class="menu-icon"></i>
                                <span style="font-weight: 600;">Viettel Money</span>
                            </a>
                        </li>
                        <li class="nav-item pt-2" style="margin-bottom: 10px;">
                            <a class="nav-link" href="/home/pay/zalo">
                                <i class="menu-icon"></i>
                                <span style="font-weight: 600;">ZaloPay</span>
                            </a>
                        </li>
                    </ul>

                    <style>
                        .nav-link {
                            display: block;
                            padding: 10px;
                            text-decoration: none;
                            color: black;
                        }

                        .nav-link:hover {
                            background-color: #8e94a9;
                            color: black;
                            border-radius: 5px;
                        }
                    </style>
                </div>
            </div>
            <div class="col-lg-7">
                <p style="font-size: 15px; font-weight: bold;">Vui lòng chuyển khoản đến số tài khoản MB BANK</p>
                <div class="text-center">
                    <div class="card-body d-flex align-items-start" style="padding: 0;">
                        <div style="display: flex; flex-direction: column;">
                            <div style="display: flex; align-items: center; width: 95%;">
                                <img style="width: 350px; height: 280px;object-fit: cover; margin-right: 15px; border-radius: 5px"
                                     src="/static/home/assets/images/mb.jpg" alt="...">
                            </div>
                        </div>
                    </div>
                </div>
                <hr>
                <div>
                    <li style="margin: 10px 0;font-size: 20px; color: black;font-weight: 600">Ngân hàng TMCP Quân Đội</li>
                </div>
                <hr>
                <div style="display: table; width: 100%;">
                    <form id="payment-form">
                        <div style="display: table-row;">
                            <div style="display: table-cell; padding-right: 10px;">
                                <ul style="list-style-type: none; padding: 0; margin: 0;">
                                    <li style="margin: 10px 0;">Số tài khoản:</li>
                                    <li style="margin: 10px 0;">Tên chủ thẻ:</li>
                                    <li style="margin: 10px 0;">Nội dung chuyển khoản:</li>
                                    <li style="margin: 10px 0;">Số tiền chuyển khoản:</li>
                                </ul>
                            </div>
                            <div style="display: table-cell;">
                                <ul style="list-style-type: none; padding: 0; margin: 0;" th:each="pay:${pay}">
                                    <li style="margin: 10px 0; font-weight: bold;">1549122052002</li>
                                    <li style="margin: 10px 0; font-weight: bold;">Công Ty Cổ Phần B.Travel</li>
                                    <li style="margin: 10px 0; font-weight: bold;" id="noi-dung-chuyen-khoan" th:text="'MB'+'_'+${pay.hoten}+'_'+${pay.sodienthoai}"></li>
                                    <li style="margin: 10px 0; font-weight: bold;" id="so-tien-chuyen-khoan" th:text="${pay.sotien}+' VND'"></li>
                                </ul>
                            </div>
                        </div>
                    </form>
                </div>
                <hr>
                <i style="color:red;">! Chú ý phải ghi đúng nội dung chuyển tiền, Sai chúng tai không chịu trách nhiệm.</i><br>
                <b>Bạn đã thanh toán xong ?</b>
                <p>Sau khi hoàn tất việc thanh toán, quý khách vui lòng vào bước xác nhận.</p>

                <button type="button" id="form-submit" class="btn btn-danger text-center">TÔI ĐÃ HOÀN THÀNH THANH TOÁN</button>
            </div>
            <div class="col-lg-3" style=" border-radius: 5px" th:each="tour:${tour}">
                <p style="font-size: 15px; font-weight: bold;">Có thể bạn quan tâm</p>
                <div style=" border-radius: 5px; padding: 0px 10px;">
                    <a th:href="@{/home/tour/tour_details(tourid=${tour.id})}">
                        <img  th:src="@{'/static/image/'+${tour.image}}" th:alt="..." style="width:80%; height: 150px; object-fit: cover; border-radius: 3%;">
                    </a>
                    <h4>
                        <a style="color: black;font-size: 15px" th:href="@{/home/tour/tour_details(tourid=${tour.id})}" th:text="${tour.tentour}"></a>
                    </h4>
                    <ul>
                        <li style="color: black;font-size: 15px"> Khởi hành: <span th:text="${tour.ngaykhoihanh}"></span></li>
                        <li style="color: black;font-size: 15px">Thời gian: <span th:text="${tour.soday} + 'Ngày ' + (${tour.soday} - 1) + 'Đêm'"></span><br>
                        <li style="color: black;font-size: 15px">Địa điểm: <span th:text="${tour.diadiem}"></span></li>
                        <li style="color: black;font-size: 15px">Ưu đãi:
                            <span style="color: red" th:text="${tour.uudai != null ? tour.uudai + '%' : '0%'}"></span>
                        </li>
                        <li style="color: black;font-size: 15px">Phương tiện:
                            <span>
                                <i th:if="${tour.phuongtien == 'Máy bay'}" class="fa-solid fa-plane"></i>
                                <i th:if="${tour.phuongtien == 'Ô tô'}" class="fa-solid fa-car"></i>
                                <i th:if="${tour.phuongtien == 'Tàu Hỏa'}" class="fa-solid fa-train"></i>
                                <i th:if="${tour.phuongtien == 'Tàu thủy'}" class="fa-solid fa-ship"></i>
                            </span>
                        </li>
                    </ul>
                    <hr>
                    <ul>
                        <li style="color: black;font-size: 15px">Giá:<span style="color:#fd7e14;font-size: 15px;font-weight: 600" th:text="${'   '+tour.gia}+' VND'"></span></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="confirmation-dialog2" style="display:none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 9999; background-color: white; border: 1px solid #ccc; padding: 20px; border-radius: 5px; text-align: center;">
    <button id="close-button" style="position: absolute; top: 10px; right: 10px; border: none; background: none; font-size: 20px; cursor: pointer;">&times;</button>
    <p><strong>Chúng tôi đang xác nhận thông tin?</strong></p>
    <p>Bạn có thể phải chờ 5 đến 10 phút nữa, bạn vào trong Gmail để nhận thông báo?</p>
    <div class="spinner-border" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
</div>
<div id="confirmation-dialog3" style="display:none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 9999; background-color: white; border: 1px solid #ccc; padding: 20px; border-radius: 5px; text-align: center;">
    <button id="close-button1" style="position: absolute; top: 10px; right: 10px; border: none; background: none; font-size: 20px; cursor: pointer;">&times;</button>
    <p><strong>Đăng nhập vào Gmail</strong></p>
    <p>Bạn có thể phải chờ 30' đến 1 tiếng để nhận hóa đơn.</p>
</div>

<footer th:replace="homelink/footer.html :: footer"></footer>

<!-- Scripts -->
<script src="vendor/jquery/jquery.min.js"></script>
<script src="vendor/bootstrap/js/bootstrap.min.js"></script>
<script src="assets/js/isotope.min.js"></script>
<script src="assets/js/owl-carousel.js"></script>
<script src="assets/js/counter.js"></script>
<script src="assets/js/custom.js"></script>

<script>
    document.getElementById('form-submit').addEventListener('click', function () {
        const noiDungChuyenKhoan = document.getElementById('noi-dung-chuyen-khoan').innerText;
        const giaTien = document.getElementById('so-tien-chuyen-khoan').innerText.replace(' VND', '');

        // Gửi yêu cầu POST tới server
        fetch('/home/pay/complete', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams({
                'noiDungChuyenKhoan': noiDungChuyenKhoan,
                'giaTien': giaTien
            })
        })
            .then(response => {
                if (response.ok) {
                    return response.text();
                }
                throw new Error('Network response was not ok.');
            })
            .then(data => {
                console.log("Dữ liệu đã được gửi thành công");
                document.getElementById('confirmation-dialog2').style.display = 'block';

                // Tự động ẩn hộp thoại đầu tiên sau 10 giây và hiện hộp thoại thứ hai
                setTimeout(function() {
                    document.getElementById('confirmation-dialog2').style.display = 'none';
                    document.getElementById('confirmation-dialog3').style.display = 'block'; // Hiện hộp thoại thứ hai

                    // Tự động ẩn hộp thoại thứ hai sau 10 giây
                    setTimeout(function() {
                        document.getElementById('confirmation-dialog3').style.display = 'none';
                    }, 5000); // 5000 ms = 10 giây
                }, 5000); // 5000 ms = 10 giây
            })
            .catch(error => console.error('Error:', error));
    });

    // Xử lý sự kiện cho nút đóng hộp thoại đầu tiên
    document.getElementById('close-button').addEventListener('click', function () {
        document.getElementById('confirmation-dialog2').style.display = 'none';
    });

    // Xử lý sự kiện cho nút đóng hộp thoại thứ hai
    document.getElementById('close-button1').addEventListener('click', function () {
        document.getElementById('confirmation-dialog3').style.display = 'none';
    });
</script>

</body>
</html>